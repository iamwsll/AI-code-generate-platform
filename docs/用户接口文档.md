# 用户接口文档

## 1. 接口概述

本文档描述了用户管理模块的所有接口，包括用户注册、登录、用户信息管理等功能。

**基础路径**: `/user`

**通用响应格式**:
```json
{
  "code": 0,
  "data": {},
  "message": "ok"
}
```

**状态码说明**:
- `0`: 成功
- `40000`: 请求参数错误
- `40100`: 未登录
- `40101`: 无权限
- `40400`: 请求数据不存在
- `40300`: 禁止访问
- `50000`: 系统内部异常
- `50001`: 操作失败

---

## 2. 公开接口（无需登录）

### 2.1 用户注册

**接口地址**: `POST /user/register`

**接口描述**: 用户注册接口，用户通过该接口创建新账号。

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| userAccount | String | 是 | 用户账号 |
| userPassword | String | 是 | 用户密码 |
| checkPassword | String | 是 | 确认密码 |

**请求示例**:
```json
{
  "userAccount": "testuser",
  "userPassword": "12345678",
  "checkPassword": "12345678"
}
```

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | Long | 新创建的用户ID |
| message | String | 响应消息 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": 1001,
  "message": "ok"
}
```

**失败响应示例**:
```json
{
  "code": 40000,
  "data": null,
  "message": "两次输入的密码不一致"
}
```

---

### 2.2 用户登录

**接口地址**: `POST /user/login`

**接口描述**: 用户登录接口，登录成功后会在 Session 中保存用户登录状态。

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| userAccount | String | 是 | 用户账号 |
| userPassword | String | 是 | 用户密码 |

**请求示例**:
```json
{
  "userAccount": "testuser",
  "userPassword": "12345678"
}
```

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | LoginUserVO | 登录用户信息（脱敏） |
| message | String | 响应消息 |

**LoginUserVO 对象结构**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| id | Long | 用户ID |
| userAccount | String | 用户账号 |
| userName | String | 用户昵称 |
| userAvatar | String | 用户头像URL |
| userProfile | String | 用户简介 |
| userRole | String | 用户角色（user/admin） |
| createTime | LocalDateTime | 创建时间 |
| updateTime | LocalDateTime | 更新时间 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": {
    "id": 1001,
    "userAccount": "testuser",
    "userName": "测试用户",
    "userAvatar": "https://example.com/avatar.jpg",
    "userProfile": "这是一个测试用户",
    "userRole": "user",
    "createTime": "2025-10-27T10:00:00",
    "updateTime": "2025-10-27T10:00:00"
  },
  "message": "ok"
}
```

**失败响应示例**:
```json
{
  "code": 40000,
  "data": null,
  "message": "账号或密码错误"
}
```

---

## 3. 需要登录的接口

### 3.1 获取当前登录用户信息

**接口地址**: `GET /user/get/login`

**接口描述**: 获取当前登录用户的详细信息。

**请求参数**: 无（通过 Session 获取）

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | LoginUserVO | 登录用户信息 |
| message | String | 响应消息 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": {
    "id": 1001,
    "userAccount": "testuser",
    "userName": "测试用户",
    "userAvatar": "https://example.com/avatar.jpg",
    "userProfile": "这是一个测试用户",
    "userRole": "user",
    "createTime": "2025-10-27T10:00:00",
    "updateTime": "2025-10-27T10:00:00"
  },
  "message": "ok"
}
```

**失败响应示例**:
```json
{
  "code": 40100,
  "data": null,
  "message": "未登录"
}
```

---

### 3.2 用户注销

**接口地址**: `POST /user/logout`

**接口描述**: 用户注销接口，清除 Session 中的登录状态。

**请求参数**: 无

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | Boolean | 注销结果（true为成功） |
| message | String | 响应消息 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": true,
  "message": "ok"
}
```

---

### 3.3 根据 ID 获取用户信息（包装类）

**接口地址**: `GET /user/get/vo`

**接口描述**: 根据用户ID获取脱敏后的用户信息。

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | Long | 是 | 用户ID（Query 参数） |

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | UserVO | 用户信息（脱敏） |
| message | String | 响应消息 |

**UserVO 对象结构**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| id | Long | 用户ID |
| userAccount | String | 用户账号 |
| userName | String | 用户昵称 |
| userAvatar | String | 用户头像URL |
| userProfile | String | 用户简介 |
| userRole | String | 用户角色（user/admin） |
| createTime | LocalDateTime | 创建时间 |

**请求示例**:
```
GET /user/get/vo?id=1001
```

**成功响应示例**:
```json
{
  "code": 0,
  "data": {
    "id": 1001,
    "userAccount": "testuser",
    "userName": "测试用户",
    "userAvatar": "https://example.com/avatar.jpg",
    "userProfile": "这是一个测试用户",
    "userRole": "user",
    "createTime": "2025-10-27T10:00:00"
  },
  "message": "ok"
}
```

---

## 4. 管理员接口（需要管理员权限）

### 4.1 创建用户

**接口地址**: `POST /user/add`

**接口描述**: 管理员创建用户接口，默认密码为 `12345678`。

**权限要求**: 管理员（admin）

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| userAccount | String | 是 | 用户账号 |
| userName | String | 否 | 用户昵称 |
| userAvatar | String | 否 | 用户头像URL |
| userProfile | String | 否 | 用户简介 |
| userRole | String | 否 | 用户角色（user/admin） |

**请求示例**:
```json
{
  "userAccount": "newuser",
  "userName": "新用户",
  "userAvatar": "https://example.com/avatar.jpg",
  "userProfile": "这是新创建的用户",
  "userRole": "user"
}
```

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | Long | 新创建的用户ID |
| message | String | 响应消息 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": 1002,
  "message": "ok"
}
```

**失败响应示例**:
```json
{
  "code": 40101,
  "data": null,
  "message": "无权限"
}
```

---

### 4.2 根据 ID 获取用户详细信息

**接口地址**: `GET /user/get`

**接口描述**: 根据用户ID获取完整的用户信息（包含敏感信息，仅管理员可用）。

**权限要求**: 管理员（admin）

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | Long | 是 | 用户ID（Query 参数） |

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | User | 完整的用户信息 |
| message | String | 响应消息 |

**请求示例**:
```
GET /user/get?id=1001
```

**成功响应示例**:
```json
{
  "code": 0,
  "data": {
    "id": 1001,
    "userAccount": "testuser",
    "userPassword": "加密后的密码",
    "userName": "测试用户",
    "userAvatar": "https://example.com/avatar.jpg",
    "userProfile": "这是一个测试用户",
    "userRole": "user",
    "createTime": "2025-10-27T10:00:00",
    "updateTime": "2025-10-27T10:00:00",
    "isDelete": 0
  },
  "message": "ok"
}
```

---

### 4.3 删除用户

**接口地址**: `POST /user/delete`

**接口描述**: 根据用户ID删除用户（逻辑删除）。

**权限要求**: 管理员（admin）

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | Long | 是 | 用户ID |

**请求示例**:
```json
{
  "id": 1001
}
```

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | Boolean | 删除结果（true为成功） |
| message | String | 响应消息 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": true,
  "message": "ok"
}
```

**失败响应示例**:
```json
{
  "code": 40000,
  "data": null,
  "message": "请求参数错误"
}
```

---

### 4.4 更新用户信息

**接口地址**: `POST /user/update`

**接口描述**: 管理员更新用户信息。

**权限要求**: 管理员（admin）

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | Long | 是 | 用户ID |
| userName | String | 否 | 用户昵称 |
| userAvatar | String | 否 | 用户头像URL |
| userProfile | String | 否 | 用户简介 |
| userRole | String | 否 | 用户角色（user/admin） |

**请求示例**:
```json
{
  "id": 1001,
  "userName": "更新后的昵称",
  "userProfile": "更新后的简介",
  "userRole": "admin"
}
```

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | Boolean | 更新结果（true为成功） |
| message | String | 响应消息 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": true,
  "message": "ok"
}
```

**失败响应示例**:
```json
{
  "code": 50001,
  "data": null,
  "message": "操作失败"
}
```

---

### 4.5 分页查询用户列表

**接口地址**: `POST /user/list/page/vo`

**接口描述**: 分页查询用户列表，支持多条件筛选，返回脱敏后的用户信息。

**权限要求**: 管理员（admin）

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| pageNum | int | 否 | 当前页号（默认1） |
| pageSize | int | 否 | 每页数量（默认10） |
| sortField | String | 否 | 排序字段 |
| sortOrder | String | 否 | 排序方式（ascend/descend，默认descend） |
| id | Long | 否 | 用户ID |
| userName | String | 否 | 用户昵称（模糊查询） |
| userAccount | String | 否 | 用户账号（模糊查询） |
| userProfile | String | 否 | 用户简介（模糊查询） |
| userRole | String | 否 | 用户角色 |

**请求示例**:
```json
{
  "pageNum": 1,
  "pageSize": 10,
  "sortField": "createTime",
  "sortOrder": "descend",
  "userName": "测试",
  "userRole": "user"
}
```

**响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | int | 状态码 |
| data | Page\<UserVO\> | 分页数据 |
| message | String | 响应消息 |

**Page\<UserVO\> 对象结构**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| records | List\<UserVO\> | 当前页数据列表 |
| totalRow | Long | 总记录数 |
| pageNumber | int | 当前页号 |
| pageSize | int | 每页数量 |
| totalPage | int | 总页数 |

**成功响应示例**:
```json
{
  "code": 0,
  "data": {
    "records": [
      {
        "id": 1001,
        "userAccount": "testuser",
        "userName": "测试用户",
        "userAvatar": "https://example.com/avatar.jpg",
        "userProfile": "这是一个测试用户",
        "userRole": "user",
        "createTime": "2025-10-27T10:00:00"
      },
      {
        "id": 1002,
        "userAccount": "testuser2",
        "userName": "测试用户2",
        "userAvatar": "https://example.com/avatar2.jpg",
        "userProfile": "这是第二个测试用户",
        "userRole": "user",
        "createTime": "2025-10-27T11:00:00"
      }
    ],
    "totalRow": 25,
    "pageNumber": 1,
    "pageSize": 10,
    "totalPage": 3
  },
  "message": "ok"
}
```

---

## 5. 认证和权限说明

### 5.1 认证机制

本系统采用 **Session** 机制进行用户认证：

1. 用户登录成功后，系统会在 Session 中保存用户登录信息
2. 后续请求通过 Cookie 携带 SessionId 来识别用户身份
3. 用户注销后，Session 中的登录信息会被清除

### 5.2 权限控制

系统通过 `@AuthCheck` 注解进行权限控制，主要有以下两种角色：

- **user**: 普通用户，只能访问基本的用户信息接口
- **admin**: 管理员，拥有所有权限，包括用户的增删改查

### 5.3 权限拦截

如果用户访问需要权限的接口时：
- 未登录：返回 `40100` 错误码，提示"未登录"
- 权限不足：返回 `40101` 错误码，提示"无权限"

---

## 6. 数据模型说明

### 6.1 User（用户实体）

| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | Long | 用户ID（主键） |
| userAccount | String | 用户账号 |
| userPassword | String | 用户密码（加密存储） |
| userName | String | 用户昵称 |
| userAvatar | String | 用户头像URL |
| userProfile | String | 用户简介 |
| userRole | String | 用户角色（user/admin） |
| createTime | LocalDateTime | 创建时间 |
| updateTime | LocalDateTime | 更新时间 |
| isDelete | Integer | 是否删除（0-未删除，1-已删除） |

### 6.2 LoginUserVO（登录用户视图对象）

包含用户的基本信息，但不包含密码等敏感信息，用于返回给前端展示。

| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | Long | 用户ID |
| userAccount | String | 用户账号 |
| userName | String | 用户昵称 |
| userAvatar | String | 用户头像URL |
| userProfile | String | 用户简介 |
| userRole | String | 用户角色 |
| createTime | LocalDateTime | 创建时间 |
| updateTime | LocalDateTime | 更新时间 |

### 6.3 UserVO（用户视图对象）

脱敏后的用户信息，不包含密码和更新时间。

| 字段名 | 类型 | 描述 |
|--------|------|------|
| id | Long | 用户ID |
| userAccount | String | 用户账号 |
| userName | String | 用户昵称 |
| userAvatar | String | 用户头像URL |
| userProfile | String | 用户简介 |
| userRole | String | 用户角色 |
| createTime | LocalDateTime | 创建时间 |

---

## 7. 业务规则说明

### 7.1 用户注册

- 账号长度需满足一定要求（具体规则在 Service 层实现）
- 密码需满足强度要求
- 两次输入的密码必须一致
- 账号不能重复

### 7.2 用户登录

- 账号和密码必须匹配
- 登录成功后会将用户信息保存到 Session 中

### 7.3 创建用户（管理员）

- 默认密码为 `12345678`（加密后存储）
- 必须指定用户账号
- 其他字段可选

### 7.4 更新用户

- 只能更新昵称、头像、简介、角色
- 不能更新账号和密码（密码修改需要单独的接口）

### 7.5 删除用户

- 采用逻辑删除，不会真正从数据库中删除数据
- 删除后的用户无法登录

---


## 8. 常见问题

### 8.1 密码是如何加密的？

系统使用加密算法（具体算法在 `UserService.getEncryptPassword()` 方法中实现）对密码进行加密存储，不会明文保存密码。

### 8.2 如何区分普通用户和管理员？

通过 `userRole` 字段区分：
- `user`: 普通用户
- `admin`: 管理员

### 8.3 UserVO 和 LoginUserVO 有什么区别？

- `LoginUserVO`: 登录后返回的用户信息，包含 `updateTime`
- `UserVO`: 查询用户列表或单个用户时返回的信息，不包含 `updateTime`


