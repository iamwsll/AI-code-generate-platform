# 静态资源接口文档

## 1. 接口概述

本文档描述了静态资源访问模块的接口，用于访问已部署的应用静态资源文件（HTML、CSS、JavaScript、图片等）。

**基础路径**: `/static`

---

## 2. 公开接口（无需登录）

### 2.1 访问静态资源

**接口地址**: `GET /static/{deployKey}/**`

**接口描述**: 通过部署标识（deployKey）访问已部署应用的静态资源文件，支持目录访问和文件访问。

**权限要求**: 无需登录（公开访问）

**请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| deployKey | String | 是 | 部署标识（Path 参数） |
| 文件路径 | String | 否 | 资源文件路径（Path 参数，支持多级目录） |

**请求示例**:
```
GET /static/abc123/                    # 访问应用首页（返回 index.html）
GET /static/abc123/index.html          # 访问 index.html
GET /static/abc123/css/style.css       # 访问 CSS 文件
GET /static/abc123/js/main.js          # 访问 JavaScript 文件
GET /static/abc123/images/logo.png     # 访问图片文件
```

**响应**: 文件内容（根据文件类型返回不同的 Content-Type）

**Content-Type 对应关系**:

| 文件扩展名 | Content-Type |
|-----------|--------------|
| .html | text/html; charset=UTF-8 |
| .css | text/css; charset=UTF-8 |
| .js | application/javascript; charset=UTF-8 |
| .png | image/png |
| .jpg | image/jpeg |
| 其他 | application/octet-stream |

**成功响应示例（HTML文件）**:
```html
<!DOCTYPE html>
<html>
<head>
    <title>待办事项应用</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <h1>待办事项列表</h1>
    <script src="js/main.js"></script>
</body>
</html>
```

**失败响应示例（文件不存在）**:

HTTP Status: 404 Not Found

**失败响应示例（服务器错误）**:

HTTP Status: 500 Internal Server Error

---

## 3. 功能特性

### 3.1 目录访问重定向

- 当访问目录路径时（不带斜杠），会自动重定向到带斜杠的 URL
- 例如：`/static/abc123` → `/static/abc123/`

**重定向响应**:

HTTP Status: 301 Moved Permanently
Location: /static/abc123/

### 3.2 默认首页

- 当访问目录路径（以斜杠结尾）时，自动返回 `index.html` 文件
- 例如：`/static/abc123/` 实际访问 `/static/abc123/index.html`

### 3.3 支持多级目录

- 支持访问任意层级的子目录和文件
- 例如：`/static/abc123/assets/images/logo.png`

### 3.4 字符编码

- 文本文件（HTML、CSS、JavaScript）统一使用 UTF-8 编码
- 确保中文等非 ASCII 字符正确显示

---

## 4. 使用场景

### 4.1 部署后的应用访问

用户在应用部署成功后，系统会生成一个唯一的 `deployKey`，通过以下 URL 可以访问已部署的应用：

```
http://localhost:8123/api/static/{deployKey}/
```

### 4.2 嵌入式应用预览

可以将部署 URL 嵌入到 iframe 中，实现应用预览功能：

```html
<iframe src="http://localhost:8123/api/static/abc123/" width="100%" height="600px"></iframe>
```

### 4.3 资源引用

在 HTML 文件中可以使用相对路径引用其他资源：

```html
<!-- 引用 CSS -->
<link rel="stylesheet" href="css/style.css">

<!-- 引用 JavaScript -->
<script src="js/main.js"></script>

<!-- 引用图片 -->
<img src="images/logo.png" alt="Logo">
```

---

## 5. 目录结构示例

典型的已部署应用目录结构：

```
{CODE_OUTPUT_ROOT_DIR}/
└── abc123/                    # deployKey
    ├── index.html             # 首页
    ├── css/
    │   └── style.css          # 样式文件
    ├── js/
    │   └── main.js            # JavaScript 文件
    └── images/
        └── logo.png           # 图片文件
```

---

## 6. 错误处理

### 6.1 文件不存在

当访问不存在的文件时，返回 404 错误：

**请求**:
```
GET /static/abc123/notfound.html
```

**响应**:
```
HTTP Status: 404 Not Found
```

### 6.2 无效的 deployKey

当使用无效的 `deployKey` 时，返回 404 错误：

**请求**:
```
GET /static/invalid_key/
```

**响应**:
```
HTTP Status: 404 Not Found
```

### 6.3 服务器内部错误

当服务器发生异常时，返回 500 错误：

**响应**:
```
HTTP Status: 500 Internal Server Error
```

---

## 7. 安全说明

### 7.1 路径安全

- 系统会验证请求路径，防止目录遍历攻击
- 只能访问 `{CODE_OUTPUT_ROOT_DIR}` 目录下的文件

### 7.2 公开访问

- 所有已部署的应用都是公开可访问的
- 不需要登录或权限验证
- deployKey 是唯一的访问凭证

### 7.3 文件类型限制

- 目前支持常见的 Web 资源文件类型（HTML、CSS、JavaScript、图片等）
- 其他类型的文件会以 `application/octet-stream` 类型返回

---

## 8. 常见问题

### 8.1 如何获取 deployKey？

通过应用部署接口（`POST /app/deploy`）部署应用后，系统会返回部署 URL，其中包含 deployKey。

